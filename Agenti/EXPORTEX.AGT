[VALUTA]
#MODESCLUSIVA
	#DISABILITAVALUTAZIONE 1 //(DISABILITA)
		#STAMPA MET_EXPORTEX;1;5000001
	
		//CARICO I DATI DI CONFIGURAZIONE PER IL FILE DA ESPORTARE
		#CERCAFILE CONFIGPERS.INI;$(PERCORSOMETODO)\PERS\$(DITTAATTIVA);NOMEFILE
		#IF $(NOMEFILE)==
			#CERCAFILE CONFIGPERS.INI;$(PERCORSOMETODO)\PERS;NOMEFILE
		#ENDIF
		#LEGGIFILEINI $(NOMEFILE);EXPORTEX;FILEPATH;;FILEPATH
		#LEGGIFILEINI $(NOMEFILE);EXPORTEX;FILE;;FILEEXPORT
		#LEGGIFILEINI $(NOMEFILE);EXPORTEX;FOGLIO;;FOGLIOEXPORT
		
		//CERCO IL FILE EXCEL PER CANCELLARLO
		#CERCAFILE $(FILEEXPORT);$(FILEPATH);FILE
		#IF $(FILE)<>
			#CANCELLAFILE $(FILE)
		#ENDIF
	#IF $(PARAMETRO)==
	#ELSE		
			//CARICO LA TABELLA TEMP DA ESPORTARE
			#DBCONNETTI #0
			#DBESEGUISQL #0;DELETE FROM MET_TMP_EXPORTEX
			#DBESEGUISQL #0;INSERT INTO MET_TMP_EXPORTEX(CODICE,DESCRIZIONE,PREZZOEURO,NOMEPROD,CODARTPROD,ESAURITO,INESAURIMENTO,ARTALTERNATIVO,LEADTIME,VERRICAMBIO) (SELECT DISTINCT CODICE,DESCRIZIONE,PREZZOEURO,NOMEPROD,CODARTPROD,ESAURITO,INESAURIMENTO,ARTALTERNATIVO,LEADTIME,VERRICAMBIO FROM MET_VISTA_EXPORTEX WHERE $(PARAMETRO))
		#DISABILITAVALUTAZIONE 0 //(ABILITA)

		#SCRIPT VBSCRIPT

			DIM STRFILE, STRFOGLIO
			DIM OBJEXC, STRQUERY
			DIM OBJREC

			' IMPOSTAZIONE FILE EXCEL E NOME FOGLIO
			STRFILE = AGTVAR.ITEM("FILEPATH") & AGTVAR.ITEM("FILEEXPORT")
			STRFOGLIO = AGTVAR.ITEM("FOGLIOEXPORT")

			' CREAZIONE OGGETTO CONNESSIONE ADO
			SET OBJEXC = CREATEOBJECT("ADODB.CONNECTION")
			IF NOT OBJEXC IS NOTHING THEN
				CALL OBJEXC.OPEN("PROVIDER=MICROSOFT.JET.OLEDB.4.0;DATA SOURCE=" & STRFILE & ";EXTENDED PROPERTIES=EXCEL 8.0")

				' ESECUZIONE QUERY DI ESPORTAZIONE SU EXCEL
				STRQUERY = "SELECT DISTINCT CODICE,DESCRIZIONE,PREZZOEURO,NOMEPROD,CODARTPROD,ESAURITO,INESAURIMENTO,ARTALTERNATIVO,LEADTIME,VERRICAMBIO "
				STRQUERY = STRQUERY & " INTO [EXCEL 8.0;DATABASE=" & STRFILE & ";HDR=NO].[" & STRFOGLIO & "]"
				STRQUERY = STRQUERY & " FROM [ODBC;" & HNDDBARCHIVI.CONNECTIONSTRING & "].MET_TMP_EXPORTEX"

				'CALL MXNU.SCRIVIPROFILO("D:\FILEINI.TXT", "PIPPO", "STRSQL", STRQUERY)
				CALL OBJEXC.EXECUTE(STRQUERY)
			END IF

			MSGBOX "PROCEDURA ESEGUITA!"

			' CHIUSURA OGGETTI
			ON ERROR RESUME NEXT
			CALL OBJEXC.CLOSE
			ON ERROR GOTO 0

			SET OBJEXC = NOTHING
			SET OBJREC = NOTHING

		#ENDSCRIPT

		#DBESEGUISQL #0;DELETE FROM MET_TMP_EXPORTEX
		#DBDISCONNETTI #0
	#ENDIF
#FINEMODESCLUSIVA