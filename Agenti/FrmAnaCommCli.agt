// ----------------------------------------------------------------------------------- //
// Agente su form anagrafica commesse per blocco cancellazione anagrafica commesse	   //
// ----------------------------------------------------------------------------------- //
//
//PROGRESSIVI QUERY APERTE
//1 - VARIE TABELLE PER CONTROLLI SEQUENZIALI REFERENZE RIFCOMMCLI
//
//PROGRESSIVI CONNESSIONI
//0 - CONNESSIONE PREDEFINITA

[CONTROLLI]
#FORM

[FORM_before_delete]
#CHR 13;cr
#CHR 32;b
#CHR 44;v
#CHR 45;TRATTINO

#MOSTRAMSGSTATO Verifica referenze commessa...

#FRMLEGGICAMPOSTR #txtb_19;RifCommCli
#LET BLOCCA=0
#LETS MSGAVVISO=Impossibile cancellare la commessa perchè referenziata in:$(CR)$(CR)

#DBCONNETTI #0

#LETS SQLDOC=SELECT RIFCOMMCLI FROM RIGHEDOCUMENTI WHERE RIFCOMMCLI='$(RifCommCli)' 
#LETS SQLORD=SELECT RIFCOMMCLI FROM RIGHEORDPROD WHERE RIFCOMMCLI='$(RifCommCli)'
#LETS SQLIMP=SELECT RIFCOMMCLI FROM IMPEGNIORDPROD WHERE RIFCOMMCLI='$(RifCommCli)'
#LETS SQLPRINOTA=SELECT CODCOMMESSA FROM RIGHECONTABILITA WHERE CODCOMMESSA='$(RifCommCli)'

#DBAPRITAB #0;#1;$(SQLDOC)
	#IF $(FINETABELLA)=1
	#ELSE
		#LETS DOCUMENTI=RIGHE DOCUMENTI
		#LET BLOCCA=1
		#LETS MSGAVVISO=$(DOCUMENTI)
	#ENDIF
#DBCHIUDITAB #1

#DBAPRITAB #0;#1;$(SQLORD)
	#IF $(FINETABELLA)=1
	#ELSE
		#LETS ORDINIPROD=RIGHE ORDINI PRODUZIONE
		#LET BLOCCA=1
		#LETS MSGAVVISO=$(MSGAVVISO)$(CR)$(ORDINIPROD)
	#ENDIF
#DBCHIUDITAB #1

#DBAPRITAB #0;#1;$(SQLIMP)
	#IF $(FINETABELLA)=1
	#ELSE
		#LETS IMPEGNIPROD=RIGHE IMPEGNI ORDINI PRODUZIONE
		#LET BLOCCA=1
		#LETS MSGAVVISO=$(MSGAVVISO)$(CR)$(IMPEGNIPROD)
	#ENDIF
#DBCHIUDITAB #1

#DBAPRITAB #0;#1;$(SQLPRINOTA)
	#IF $(FINETABELLA)=1
	#ELSE
		#LETS PRIMANOTA=RIGHE CONTABILITA
		#LET BLOCCA=1
		#LETS MSGAVVISO=$(MSGAVVISO)$(CR)$(PRIMANOTA)
	#ENDIF
#DBCHIUDITAB #1

#IF $(BLOCCA)=0
#ELSE
	#MESSAGGIO 0;$(MSGAVVISO);Attenzione!!!
	#ANNULLA
#ENDIF

#CANCELLAMSGSTATO
#DBDISCONNETTI #0